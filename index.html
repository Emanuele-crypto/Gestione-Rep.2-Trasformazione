<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema Gestione Produzione Agrumi - Reparto 2</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f8f9fa;
        }
        .header {
            background-color: #D4A017; /* Giallo ocra */
            color: white;
            padding: 15px 0;
            margin-bottom: 30px;
        }
        .card {
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .card-header {
            background-color: #f5efd4;
            font-weight: bold;
        }
        .stats-card {
            text-align: center;
            padding: 15px;
        }
        .stats-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: #D4A017;
        }
        .btn-custom {
            background-color: #D4A017;
            color: white;
        }
        .btn-custom:hover {
            background-color: #b08612;
            color: white;
        }
        .required-field::after {
            content: " *";
            color: red;
        }
        /* Aggiungiamo un po' di stile per i pulsanti di registrazione */
        .btn-registro {
            background-color: #0056b3;
            color: white;
            font-weight: bold;
        }
        .btn-registro:hover {
            background-color: #004494;
            color: white;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-md-2 text-start">
                    <button class="btn btn-light" id="btn-reparto-1">
                        <i class="bi bi-arrow-left-circle"></i> Reparto 1
                    </button>
                </div>
                <div class="col-md-8 text-center">
                    <h1>SIMONE GATTO PROD-REPARTO 2- TRASFORMAZIONE</h1>
                </div>
                <div class="col-md-2 text-end">
                    <button class="btn btn-light" id="btn-reparto-3">
                        Reparto 3 <i class="bi bi-arrow-right-circle"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="container mb-5">
        <!-- Statistiche -->
        <div class="row mb-4">
            <div class="col-md-3">
                <div class="card stats-card">
                    <div class="stats-value" id="total-lotti">0</div>
                    <div>Lotti in Lavorazione</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card stats-card">
                    <div class="stats-value" id="total-succo">0 L</div>
                    <div>Succo Totale</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card stats-card">
                    <div class="stats-value" id="total-olio">0 L</div>
                    <div>Olio Essenziale</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card stats-card">
                    <div class="stats-value" id="lotti-registrati">0</div>
                    <div>Lotti Registrati</div>
                </div>
            </div>
        </div>

        <!-- Form inserimento dati -->
        <div class="card mb-4">
            <div class="card-header">
                <i class="bi bi-pencil-square"></i> Inserimento Dati di Lavorazione
            </div>
            <div class="card-body">
                <form id="produzione-form">
                    <div class="row mb-3">
                        <div class="col-md-4">
                            <label for="linea-trasformazione" class="form-label required-field">Linea di Trasformazione</label>
                            <select class="form-select" id="linea-trasformazione" required>
                                <option value="" selected disabled>Seleziona...</option>
                                <option value="BOE">BOE</option>
                                <option value="GOE INT">GOE INT</option>
                                <option value="B/SF">B/SF</option>
                                <option value="400">400</option>
                                <option value="ALTRA">ALTRA</option>
                            </select>
                            <div id="altra-linea-container" style="display: none;" class="mt-2">
                                <input type="text" class="form-control" id="altra-linea" placeholder="Specifica altra linea">
                            </div>
                        </div>
                        <div class="col-md-4">
                            <label for="fornitore" class="form-label required-field">Fornitore</label>
                            <select class="form-select" id="fornitore" required>
                                <option value="" selected disabled>Seleziona...</option>
                                <option value="ARCO">ARCO</option>
                                <option value="CI">CI</option>
                                <option value="RESTUCCIA">RESTUCCIA</option>
                                <option value="ALTRO">ALTRO</option>
                            </select>
                            <div id="altro-fornitore-container" style="display: none;" class="mt-2">
                                <input type="text" class="form-control" id="altro-fornitore" placeholder="Specifica altro fornitore">
                            </div>
                        </div>
                        <div class="col-md-4">
                            <label for="tipo-agrume" class="form-label required-field">Tipo Agrume</label>
                            <select class="form-select" id="tipo-agrume" required>
                                <option value="" selected disabled>Seleziona...</option>
                                <option value="Arance">Arance</option>
                                <option value="Arance Rosse">Arance Rosse</option>
                                <option value="Limoni">Limoni</option>
                                <option value="Mandarini">Mandarini</option>
                                <option value="Pompelmi">Pompelmi</option>
                                <option value="Altro">Altro</option>
                            </select>
                            <div id="altro-agrume-container" style="display: none;" class="mt-2">
                                <input type="text" class="form-control" id="altro-agrume" placeholder="Specifica altro agrume">
                            </div>
                        </div>
                    </div>

                    <div class="row mb-3">
                        <div class="col-md-4">
                            <label for="destinazione-essenza" class="form-label required-field">Destinazione Essenza</label>
                            <select class="form-select" id="destinazione-essenza" required>
                                <option value="" selected disabled>Seleziona...</option>
                                <option value="Bio">Bio</option>
                                <option value="Convenzionale">Convenzionale</option>
                                <option value="Non Trattato">Non Trattato</option>
                                <option value="Altra">Altra</option>
                            </select>
                            <div id="altra-essenza-container" style="display: none;" class="mt-2">
                                <input type="text" class="form-control" id="altra-essenza" placeholder="Specifica altra destinazione">
                            </div>
                        </div>
                        <div class="col-md-4">
                            <label for="certificazione" class="form-label required-field">Certificazione</label>
                            <select class="form-select" id="certificazione" required>
                                <option value="" selected disabled>Seleziona...</option>
                                <option value="BIO EU">BIO EU</option>
                                <option value="BIO DEMETER">BIO DEMETER</option>
                                <option value="CONVENZIONALE">CONVENZIONALE</option>
                                <option value="IGP">IGP</option>
                                <option value="ALTRO">ALTRO</option>
                            </select>
                            <div id="altra-certificazione-container" style="display: none;" class="mt-2">
                                <input type="text" class="form-control" id="altra-certificazione" placeholder="Specifica altra certificazione">
                            </div>
                        </div>
                        <div class="col-md-4">
                            <label for="quantita" class="form-label required-field">Quantità (kg)</label>
                            <input type="number" class="form-control" id="quantita" required min="1">
                        </div>
                    </div>

                    <h5 class="mt-4 mb-3 border-bottom pb-2">Destinazione Spremiture</h5>
                    
                    <div class="row mb-4">
                        <div class="col-md-3">
                            <label for="prima-spremitura" class="form-label">1ª Spremitura</label>
                            <select class="form-select" id="prima-spremitura">
                                <option value="" selected disabled>Seleziona...</option>
                                <option value="CISTERNA PL">CISTERNA PL</option>
                                <option value="CISTERNA VK">CISTERNA VK</option>
                                <option value="CISTERNA EF">CISTERNA EF</option>
                                <option value="NAT IN TINI CONSERVATO">NAT IN TINI CONSERVATO</option>
                                <option value="F.F.">F.F.</option>
                                <option value="F.T.C.">F.T.C.</option>
                                <option value="LATTE 20 KG">LATTE 20 KG</option>
                                <option value="VASCHETTE">VASCHETTE</option>
                                <option value="VASCHETTE ZUCCHERATE">VASCHETTE ZUCCHERATE</option>
                                <option value="REX">REX</option>
                                <option value="ACMA">ACMA</option>
                                <option value="GOGLIO 3 KG">GOGLIO 3 KG</option>
                                <option value="PET 100">PET 100</option>
                                <option value="PET 200">PET 200</option>
                                <option value="PET 480">PET 480</option>
                                <option value="CONCENTRATO">CONCENTRATO</option>
                                <option value="ALTRO">ALTRO</option>
                                <option value="Nessuna">Nessuna</option>
                            </select>
                            <div class="mt-2">
                                <input type="number" class="form-control" id="quantita-prima" placeholder="Quantità (L)" min="0">
                            </div>
                            <div id="concentrato-container-prima" style="display: none;" class="mt-2">
                                <label for="grado-bx-prima" class="form-label">Grado °BX</label>
                                <select class="form-select" id="grado-bx-prima">
                                    <option value="" selected disabled>Seleziona...</option>
                                    <option value="32 BX">32 BX</option>
                                    <option value="38 BX">38 BX</option>
                                    <option value="40 BX">40 BX</option>
                                    <option value="45 BX">45 BX</option>
                                    <option value="48 BX">48 BX</option>
                                    <option value="55 BX">55 BX</option>
                                    <option value="58 BX">58 BX</option>
                                    <option value="60 BX">60 BX</option>
                                </select>
                                
                                <label for="tenore-polpa-prima" class="form-label mt-2">Tenore di Polpa</label>
                                <select class="form-select" id="tenore-polpa-prima">
                                    <option value="" selected disabled>Seleziona...</option>
                                    <option value="STANDARD">STANDARD</option>
                                    <option value="1-3%">1-3%</option>
                                    <option value="2%">2%</option>
                                    <option value="3%">3%</option>
                                    <option value="<7% SEMICLEAR"><7% SEMICLEAR</option>
                                    <option value="LIMPIDO">LIMPIDO</option>
                                </select>
                                
                                <label for="stoccaggio-prima" class="form-label mt-2">Stoccaggio Prodotto</label>
                                <select class="form-select" id="stoccaggio-prima">
                                    <option value="" selected disabled>Seleziona...</option>
                                    <option value="SERB 36">SERB 36</option>
                                    <option value="SERB 45">SERB 45</option>
                                    <option value="SERB 39">SERB 39</option>
                                    <option value="1 Azz.">1 Azz.</option>
                                    <option value="2 Azz.">2 Azz.</option>
                                    <option value="3 Azz.">3 Azz.</option>
                                    <option value="4 Azz.">4 Azz.</option>
                                    <option value="5 Azz.">5 Azz.</option>
                                    <option value="6 Azz.">6 Azz.</option>
                                    <option value="7 Azz.">7 Azz.</option>
                                    <option value="8 Azz.">8 Azz.</option>
                                    <option value="9 Azz.">9 Azz.</option>
                                    <option value="10 Azz.">10 Azz.</option>
                                </select>
                            </div>
                            <div class="mt-2">
                                <label for="note-prima" class="form-label">Note</label>
                                <textarea class="form-control" id="note-prima" rows="2"></textarea>
                            </div>
                        </div>
                        
                        <div class="col-md-3">
                            <label for="seconda-spremitura" class="form-label">2ª Spremitura</label>
                            <select class="form-select" id="seconda-spremitura">
                                <option value="" selected disabled>Seleziona...</option>
                                <option value="CISTERNA PL">CISTERNA PL</option>
                                <option value="CISTERNA VK">CISTERNA VK</option>
                                <option value="CISTERNA EF">CISTERNA EF</option>
                                <option value="NAT IN TINI CONSERVATO">NAT IN TINI CONSERVATO</option>
                                <option value="F.F.">F.F.</option>
                                <option value="F.T.C.">F.T.C.</option>
                                <option value="LATTE 20 KG">LATTE 20 KG</option>
                                <option value="VASCHETTE">VASCHETTE</option>
                                <option value="VASCHETTE ZUCCHERATE">VASCHETTE ZUCCHERATE</option>
                                <option value="REX">REX</option>
                                <option value="ACMA">ACMA</option>
                                <option value="GOGLIO 3 KG">GOGLIO 3 KG</option>
                                <option value="PET 100">PET 100</option>
                                <option value="PET 200">PET 200</option>
                                <option value="PET 480">PET 480</option>
                                <option value="CONCENTRATO">CONCENTRATO</option>
                                <option value="ALTRO">ALTRO</option>
                                <option value="Nessuna">Nessuna</option>
                            </select>
                            <div class="mt-2">
                                <input type="number" class="form-control" id="quantita-seconda" placeholder="Quantità (L)" min="0">
                            </div>
                            <div id="concentrato-container-seconda" style="display: none;" class="mt-2">
                                <label for="grado-bx-seconda" class="form-label">Grado °BX</label>
                                <select class="form-select" id="grado-bx-seconda">
                                    <option value="" selected disabled>Seleziona...</option>
                                    <option value="32 BX">32 BX</option>
                                    <option value="38 BX">38 BX</option>
                                    <option value="40 BX">40 BX</option>
                                    <option value="45 BX">45 BX</option>
                                    <option value="48 BX">48 BX</option>
                                    <option value="55 BX">55 BX</option>
                                    <option value="58 BX">58 BX</option>
                                    <option value="60 BX">60 BX</option>
                                </select>
                                
                                <label for="tenore-polpa-seconda" class="form-label mt-2">Tenore di Polpa</label>
                                <select class="form-select" id="tenore-polpa-seconda">
                                    <option value="" selected disabled>Seleziona...</option>
                                    <option value="STANDARD">STANDARD</option>
                                    <option value="1-3%">1-3%</option>
                                    <option value="2%">2%</option>
                                    <option value="3%">3%</option>
                                    <option value="<7% SEMICLEAR"><7% SEMICLEAR</option>
                                    <option value="LIMPIDO">LIMPIDO</option>
                                </select>
                                
                                <label for="stoccaggio-seconda" class="form-label mt-2">Stoccaggio Prodotto</label>
                                <select class="form-select" id="stoccaggio-seconda">
                                    <option value="" selected disabled>Seleziona...</option>
                                    <option value="SERB 36">SERB 36</option>
                                    <option value="SERB 45">SERB 45</option>
                                    <option value="SERB 39">SERB 39</option>
                                    <option value="1 Azz.">1 Azz.</option>
                                    <option value="2 Azz.">2 Azz.</option>
                                    <option value="3 Azz.">3 Azz.</option>
                                    <option value="4 Azz.">4 Azz.</option>
                                    <option value="5 Azz.">5 Azz.</option>
                                    <option value="6 Azz.">6 Azz.</option>
                                    <option value="7 Azz.">7 Azz.</option>
                                    <option value="8 Azz.">8 Azz.</option>
                                    <option value="9 Azz.">9 Azz.</option>
                                    <option value="10 Azz.">10 Azz.</option>
                                </select>
                            </div>
                            <div class="mt-2">
                                <label for="note-seconda" class="form-label">Note</label>
                                <textarea class="form-control" id="note-seconda" rows="2"></textarea>
                            </div>
                        </div>
                        
                        <div class="col-md-3">
                            <label for="torchiato" class="form-label">Torchiato</label>
                            <select class="form-select" id="torchiato">
                                <option value="" selected disabled>Seleziona...</option>
                                <option value="CISTERNA PL">CISTERNA PL</option>
                                <option value="CISTERNA VK">CISTERNA VK</option>
                                <option value="CISTERNA EF">CISTERNA EF</option>
                                <option value="NAT IN TINI CONSERVATO">NAT IN TINI CONSERVATO</option>
                                <option value="F.F.">F.F.</option>
                                <option value="F.T.C.">F.T.C.</option>
                                <option value="LATTE 20 KG">LATTE 20 KG</option>
                                <option value="VASCHETTE">VASCHETTE</option>
                                <option value="VASCHETTE ZUCCHERATE">VASCHETTE ZUCCHERATE</option>
                                <option value="REX">REX</option>
                                <option value="ACMA">ACMA</option>
                                <option value="GOGLIO 3 KG">GOGLIO 3 KG</option>
                                <option value="PET 100">PET 100</option>
                                <option value="PET 200">PET 200</option>
                                <option value="PET 480">PET 480</option>
                                <option value="CONCENTRATO">CONCENTRATO</option>
                                <option value="ALTRO">ALTRO</option>
                                <option value="Nessuna">Nessuna</option>
                            </select>
                            <div class="mt-2">
                                <input type="number" class="form-control" id="quantita-torchiato" placeholder="Quantità (L)" min="0">
                            </div>
                            <div id="concentrato-container-torchiato" style="display: none;" class="mt-2">
                                <label for="grado-bx-torchiato" class="form-label">Grado °BX</label>
                                <select class="form-select" id="grado-bx-torchiato">
                                    <option value="" selected disabled>Seleziona...</option>
                                    <option value="32 BX">32 BX</option>
                                    <option value="38 BX">38 BX</option>
                                    <option value="40 BX">40 BX</option>
                                    <option value="45 BX">45 BX</option>
                                    <option value="48 BX">48 BX</option>
                                    <option value="55 BX">55 BX</option>
                                    <option value="58 BX">58 BX</option>
                                    <option value="60 BX">60 BX</option>
                                </select>
                                
                                <label for="tenore-polpa-torchiato" class="form-label mt-2">Tenore di Polpa</label>
                                <select class="form-select" id="tenore-polpa-torchiato">
                                    <option value="" selected disabled>Seleziona...</option>
                                    <option value="STANDARD">STANDARD</option>
                                    <option value="1-3%">1-3%</option>
                                    <option value="2%">2%</option>
                                    <option value="3%">3%</option>
                                    <option value="<7% SEMICLEAR"><7% SEMICLEAR</option>
                                    <option value="LIMPIDO">LIMPIDO</option>
                                </select>
                                
                                <label for="stoccaggio-torchiato" class="form-label mt-2">Stoccaggio Prodotto</label>
                                <select class="form-select" id="stoccaggio-torchiato">
                                    <option value="" selected disabled>Seleziona...</option>
                                    <option value="SERB 36">SERB 36</option>
                                    <option value="SERB 45">SERB 45</option>
                                    <option value="SERB 39">SERB 39</option>
                                    <option value="1 Azz.">1 Azz.</option>
                                    <option value="2 Azz.">2 Azz.</option>
                                    <option value="3 Azz.">3 Azz.</option>
                                    <option value="4 Azz.">4 Azz.</option>
                                    <option value="5 Azz.">5 Azz.</option>
                                    <option value="6 Azz.">6 Azz.</option>
                                    <option value="7 Azz.">7 Azz.</option>
                                    <option value="8 Azz.">8 Azz.</option>
                                    <option value="9 Azz.">9 Azz.</option>
                                    <option value="10 Azz.">10 Azz.</option>
                                </select>
                            </div>
                            <div class="mt-2">
                                <label for="note-torchiato" class="form-label">Note</label>
                                <textarea class="form-control" id="note-torchiato" rows="2"></textarea>
                            </div>
                        </div>
                        
                        <div class="col-md-3">
                            <label for="v-fiorentina" class="form-label">V. Fiorentina</label>
                            <select class="form-select" id="v-fiorentina">
                                <option value="" selected disabled>Seleziona...</option>
                                <option value="CISTERNA PL">CISTERNA PL</option>
                                <option value="CISTERNA VK">CISTERNA VK</option>
                                <option value="CISTERNA EF">CISTERNA EF</option>
                                <option value="NAT IN TINI CONSERVATO">NAT IN TINI CONSERVATO</option>
                                <option value="F.F.">F.F.</option>
                                <option value="F.T.C.">F.T.C.</option>
                                <option value="LATTE 20 KG">LATTE 20 KG</option>
                                <option value="VASCHETTE">VASCHETTE</option>
                                <option value="VASCHETTE ZUCCHERATE">VASCHETTE ZUCCHERATE</option>
                                <option value="REX">REX</option>
                                <option value="ACMA">ACMA</option>
                                <option value="GOGLIO 3 KG">GOGLIO 3 KG</option>
                                <option value="PET 100">PET 100</option>
                                <option value="PET 200">PET 200</option>
                                <option value="PET 480">PET 480</option>
                                <option value="CONCENTRATO">CONCENTRATO</option>
                                <option value="ALTRO">ALTRO</option>
                                <option value="Nessuna">Nessuna</option>
                            </select>
                            <div class="mt-2">
                                <input type="number" class="form-control" id="quantita-fiorentina" placeholder="Quantità (L)" min="0">
                            </div>
                            <div id="concentrato-container-fiorentina" style="display: none;" class="mt-2">
                                <label for="grado-bx-fiorentina" class="form-label">Grado °BX</label>
                                <select class="form-select" id="grado-bx-fiorentina">
                                    <option value="" selected disabled>Seleziona...</option>
                                    <option value="32 BX">32 BX</option>
                                    <option value="38 BX">38 BX</option>
                                    <option value="40 BX">40 BX</option>
                                    <option value="45 BX">45 BX</option>
                                    <option value="48 BX">48 BX</option>
                                    <option value="55 BX">55 BX</option>
                                    <option value="58 BX">58 BX</option>
                                    <option value="60 BX">60 BX</option>
                                </select>
                                
                                <label for="tenore-polpa-fiorentina" class="form-label mt-2">Tenore di Polpa</label>
                                <select class="form-select" id="tenore-polpa-fiorentina">
                                    <option value="" selected disabled>Seleziona...</option>
                                    <option value="STANDARD">STANDARD</option>
                                    <option value="1-3%">1-3%</option>
                                    <option value="2%">2%</option>
                                    <option value="3%">3%</option>
                                    <option value="<7% SEMICLEAR"><7% SEMICLEAR</option>
                                    <option value="LIMPIDO">LIMPIDO</option>
                                </select>
                                
                                <label for="stoccaggio-fiorentina" class="form-label mt-2">Stoccaggio Prodotto</label>
                                <select class="form-select" id="stoccaggio-fiorentina">
                                    <option value="" selected disabled>Seleziona...</option>
                                    <option value="SERB 36">SERB 36</option>
                                    <option value="SERB 45">SERB 45</option>
                                    <option value="SERB 39">SERB 39</option>
                                    <option value="1 Azz.">1 Azz.</option>
                                    <option value="2 Azz.">2 Azz.</option>
                                    <option value="3 Azz.">3 Azz.</option>
                                    <option value="4 Azz.">4 Azz.</option>
                                    <option value="5 Azz.">5 Azz.</option>
                                    <option value="6 Azz.">6 Azz.</option>
                                    <option value="7 Azz.">7 Azz.</option>
                                    <option value="8 Azz.">8 Azz.</option>
                                    <option value="9 Azz.">9 Azz.</option>
                                    <option value="10 Azz.">10 Az
                                        <option value="10 Azz.">10 Azz.</option>
                               </select>
                           </div>
                           <div class="mt-2">
                               <label for="note-fiorentina" class="form-label">Note</label>
                               <textarea class="form-control" id="note-fiorentina" rows="2"></textarea>
                           </div>
                       </div>
                   </div>

                   <div class="text-end mt-4">
                       <button type="button" class="btn btn-secondary me-2" id="btn-reset">
                           <i class="bi bi-x-circle"></i> Annulla
                       </button>
                       <button type="submit" class="btn btn-custom me-2">
                           <i class="bi bi-save"></i> Salva Dati
                       </button>
                       <button type="button" class="btn btn-registro" id="btn-registro-elettronico">
                           <i class="bi bi-journal-check"></i> Registra su Bolletta Elettronica
                       </button>
                   </div>
               </form>
           </div>
       </div>
   </div>

   <!-- Script JS -->
   <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
   <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
   <script>
       $(document).ready(function() {
           // Dati di stato
           let lottiCount = 0;
           let succoTotale = 0;
           let olioTotale = 0;
           let lottiRegistrati = 0;
           
           // Gestione altra linea di trasformazione
           $("#linea-trasformazione").change(function() {
               if ($(this).val() === "ALTRA") {
                   $("#altra-linea-container").show();
               } else {
                   $("#altra-linea-container").hide();
                   $("#altra-linea").val("");
               }
           });
           
           // Gestione altro fornitore
           $("#fornitore").change(function() {
               if ($(this).val() === "ALTRO") {
                   $("#altro-fornitore-container").show();
               } else {
                   $("#altro-fornitore-container").hide();
                   $("#altro-fornitore").val("");
               }
           });
           
           // Gestione altro agrume
           $("#tipo-agrume").change(function() {
               if ($(this).val() === "Altro") {
                   $("#altro-agrume-container").show();
               } else {
                   $("#altro-agrume-container").hide();
                   $("#altro-agrume").val("");
               }
           });
           
           // Gestione altra destinazione essenza
           $("#destinazione-essenza").change(function() {
               if ($(this).val() === "Altra") {
                   $("#altra-essenza-container").show();
               } else {
                   $("#altra-essenza-container").hide();
                   $("#altra-essenza").val("");
               }
           });
           
           // Gestione altra certificazione
           $("#certificazione").change(function() {
               if ($(this).val() === "ALTRO") {
                   $("#altra-certificazione-container").show();
               } else {
                   $("#altra-certificazione-container").hide();
                   $("#altra-certificazione").val("");
               }
           });
           
           // IMPORTANTE: Gestione campi CONCENTRATO (utilizzo di variabili jQuery e .on diretto con funzione freccia)
           // Prima spremitura
           $("#prima-spremitura").on("change", function() {
               if ($(this).val() === "CONCENTRATO") {
                   $("#concentrato-container-prima").slideDown();
               } else {
                   $("#concentrato-container-prima").slideUp();
                   $("#grado-bx-prima").val("");
                   $("#tenore-polpa-prima").val("");
                   $("#stoccaggio-prima").val("");
               }
           });
           
           // Seconda spremitura
           $("#seconda-spremitura").on("change", function() {
               if ($(this).val() === "CONCENTRATO") {
                   $("#concentrato-container-seconda").slideDown();
               } else {
                   $("#concentrato-container-seconda").slideUp();
                   $("#grado-bx-seconda").val("");
                   $("#tenore-polpa-seconda").val("");
                   $("#stoccaggio-seconda").val("");
               }
           });
           
           // Torchiato
           $("#torchiato").on("change", function() {
               if ($(this).val() === "CONCENTRATO") {
                   $("#concentrato-container-torchiato").slideDown();
               } else {
                   $("#concentrato-container-torchiato").slideUp();
                   $("#grado-bx-torchiato").val("");
                   $("#tenore-polpa-torchiato").val("");
                   $("#stoccaggio-torchiato").val("");
               }
           });
           
           // V. Fiorentina
           $("#v-fiorentina").on("change", function() {
               if ($(this).val() === "CONCENTRATO") {
                   $("#concentrato-container-fiorentina").slideDown();
               } else {
                   $("#concentrato-container-fiorentina").slideUp();
                   $("#grado-bx-fiorentina").val("");
                   $("#tenore-polpa-fiorentina").val("");
                   $("#stoccaggio-fiorentina").val("");
               }
           });
           
           // Pulsante reset form
           $("#btn-reset").click(function() {
               if (confirm("Vuoi davvero annullare? I dati inseriti andranno persi.")) {
                   $("#produzione-form")[0].reset();
                   $("[id^='concentrato-container-']").hide();
                   $("[id$='-container']").hide();
               }
           });
           
           // Pulsanti navigazione reparti
           $("#btn-reparto-1").click(function() {
               if (confirm("Passare al Reparto 1? Le modifiche non salvate andranno perse.")) {
                   alert("Collegamento al Reparto 1 simulato.");
               }
           });
           
           $("#btn-reparto-3").click(function() {
               if (confirm("Passare al Reparto 3? Le modifiche non salvate andranno perse.")) {
                   alert("Collegamento al Reparto 3 simulato.");
               }
           });
           
           // Pulsante registro elettronico
           $("#btn-registro-elettronico").click(function() {
               // Verifica se ci sono dati da registrare
               if (lottiCount === 0) {
                   alert("Non ci sono lotti da registrare nella bolletta elettronica.");
                   return;
               }
               
               // Simulazione registrazione
               let numeroRegistrazione = "REG-" + new Date().getTime().toString().substr(-6);
               lottiRegistrati++;
               
               // Aggiornamento contatore
               $("#lotti-registrati").text(lottiRegistrati);
               
               alert("Registrazione su bolletta elettronica completata con successo!\nNumero registrazione: " + numeroRegistrazione);
           });
           
           // Salvataggio dati produzione
           $("#produzione-form").submit(function(e) {
               e.preventDefault();
               
               // Validazione form
               
               // Raccolta dati
               let lineaTrasformazione = $("#linea-trasformazione").val();
               if (lineaTrasformazione === "ALTRA") {
                   lineaTrasformazione = $("#altra-linea").val();
               }
               
               let fornitore = $("#fornitore").val();
               if (fornitore === "ALTRO") {
                   fornitore = $("#altro-fornitore").val();
               }
               
               let tipoAgrume = $("#tipo-agrume").val();
               if (tipoAgrume === "Altro") {
                   tipoAgrume = $("#altro-agrume").val();
               }
               
               let destinazioneEssenza = $("#destinazione-essenza").val();
               if (destinazioneEssenza === "Altra") {
                   destinazioneEssenza = $("#altra-essenza").val();
               }
               
               let certificazione = $("#certificazione").val();
               if (certificazione === "ALTRO") {
                   certificazione = $("#altra-certificazione").val();
               }
               
               let quantita = parseInt($("#quantita").val());
               
               // Dati spremiture con supporto per concentrato e note
               let spremiture = {
                   prima: {
                       destinazione: $("#prima-spremitura").val(),
                       quantita: parseInt($("#quantita-prima").val()) || 0,
                       gradoBx: $("#prima-spremitura").val() === "CONCENTRATO" ? $("#grado-bx-prima").val() : null,
                       tenorePolpa: $("#prima-spremitura").val() === "CONCENTRATO" ? $("#tenore-polpa-prima").val() : null,
                       stoccaggio: $("#prima-spremitura").val() === "CONCENTRATO" ? $("#stoccaggio-prima").val() : null,
                       note: $("#note-prima").val()
                   },
                   seconda: {
                       destinazione: $("#seconda-spremitura").val(),
                       quantita: parseInt($("#quantita-seconda").val()) || 0,
                       gradoBx: $("#seconda-spremitura").val() === "CONCENTRATO" ? $("#grado-bx-seconda").val() : null,
                       tenorePolpa: $("#seconda-spremitura").val() === "CONCENTRATO" ? $("#tenore-polpa-seconda").val() : null,
                       stoccaggio: $("#seconda-spremitura").val() === "CONCENTRATO" ? $("#stoccaggio-seconda").val() : null,
                       note: $("#note-seconda").val()
                   },
                   torchiato: {
                       destinazione: $("#torchiato").val(),
                       quantita: parseInt($("#quantita-torchiato").val()) || 0,
                       gradoBx: $("#torchiato").val() === "CONCENTRATO" ? $("#grado-bx-torchiato").val() : null,
                       tenorePolpa: $("#torchiato").val() === "CONCENTRATO" ? $("#tenore-polpa-torchiato").val() : null,
                       stoccaggio: $("#torchiato").val() === "CONCENTRATO" ? $("#stoccaggio-torchiato").val() : null,
                       note: $("#note-torchiato").val()
                   },
                   fiorentina: {
                       destinazione: $("#v-fiorentina").val(),
                       quantita: parseInt($("#quantita-fiorentina").val()) || 0,
                       gradoBx: $("#v-fiorentina").val() === "CONCENTRATO" ? $("#grado-bx-fiorentina").val() : null,
                       tenorePolpa: $("#v-fiorentina").val() === "CONCENTRATO" ? $("#tenore-polpa-fiorentina").val() : null,
                       stoccaggio: $("#v-fiorentina").val() === "CONCENTRATO" ? $("#stoccaggio-fiorentina").val() : null,
                       note: $("#note-fiorentina").val()
                   }
               };
               
               // Verifica che almeno una spremitura sia selezionata
               if ((!spremiture.prima.destinazione || spremiture.prima.destinazione === "Nessuna") &&
                   (!spremiture.seconda.destinazione || spremiture.seconda.destinazione === "Nessuna") &&
                   (!spremiture.torchiato.destinazione || spremiture.torchiato.destinazione === "Nessuna") &&
                   (!spremiture.fiorentina.destinazione || spremiture.fiorentina.destinazione === "Nessuna")) {
                   alert("Seleziona almeno una destinazione per le spremiture!");
                   return;
               }
               
               // Verifica che le quantità siano specificate per le spremiture selezionate
               if ((spremiture.prima.destinazione && spremiture.prima.destinazione !== "Nessuna" && spremiture.prima.quantita <= 0) ||
                   (spremiture.seconda.destinazione && spremiture.seconda.destinazione !== "Nessuna" && spremiture.seconda.quantita <= 0) ||
                   (spremiture.torchiato.destinazione && spremiture.torchiato.destinazione !== "Nessuna" && spremiture.torchiato.quantita <= 0) ||
                   (spremiture.fiorentina.destinazione && spremiture.fiorentina.destinazione !== "Nessuna" && spremiture.fiorentina.quantita <= 0)) {
                   alert("Inserisci una quantità valida per ogni spremitura selezionata!");
                   return;
               }
               
               // Verifica che per ogni spremitura con "CONCENTRATO" siano specificati tutti i campi richiesti
               if ((spremiture.prima.destinazione === "CONCENTRATO" && (!spremiture.prima.gradoBx || !spremiture.prima.tenorePolpa || !spremiture.prima.stoccaggio)) ||
                   (spremiture.seconda.destinazione === "CONCENTRATO" && (!spremiture.seconda.gradoBx || !spremiture.seconda.tenorePolpa || !spremiture.seconda.stoccaggio)) ||
                   (spremiture.torchiato.destinazione === "CONCENTRATO" && (!spremiture.torchiato.gradoBx || !spremiture.torchiato.tenorePolpa || !spremiture.torchiato.stoccaggio)) ||
                   (spremiture.fiorentina.destinazione === "CONCENTRATO" && (!spremiture.fiorentina.gradoBx || !spremiture.fiorentina.tenorePolpa || !spremiture.fiorentina.stoccaggio))) {
                   alert("Per le spremiture con destinazione 'CONCENTRATO' devi specificare Grado °BX, Tenore di Polpa e Stoccaggio Prodotto!");
                   return;
               }
               
               // Simulazione generazione ID lotto
               const now = new Date();
               const lottoId = "L-" + 
                              now.getFullYear() + 
                              padZero(now.getMonth() + 1) + 
                              padZero(now.getDate()) + "-" + 
                              padZero(now.getHours()) + 
                              padZero(now.getMinutes());
               
               // Incremento contatori
               lottiCount++;
               succoTotale += spremiture.prima.quantita + spremiture.seconda.quantita + 
                             spremiture.torchiato.quantita + spremiture.fiorentina.quantita;
               olioTotale += quantita * 0.01; // Simulazione 1% di olio essenziale
               
               // Aggiornamento statistiche
               updateStats();
               
               // Reset form
               $("#produzione-form")[0].reset();
               $("[id^='concentrato-container-']").hide();
               $("[id$='-container']").hide();
               
               alert("Dati di produzione salvati con successo!\nID Lotto: " + lottoId);
           });
           
           // Aggiornamento statistiche
           function updateStats() {
               $("#total-lotti").text(lottiCount);
               $("#total-succo").text(succoTotale + " L");
               $("#total-olio").text(olioTotale.toFixed(2) + " L");
               $("#lotti-registrati").text(lottiRegistrati);
           }
           
           // Utility per padding zeri
           function padZero(num) {
               return num < 10 ? "0" + num : num;
           }
       });
   </script>
</body>
</html>
